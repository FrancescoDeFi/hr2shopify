{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign use_locale_copy = false %}
{% unless locale_prefix == 'de' %}
  {% assign use_locale_copy = true %}
{% endunless %}

{% assign quality_heading = section.settings.heading %}
{% if use_locale_copy or quality_heading == blank %}
  {% assign quality_heading = 'sections.quality.heading' | t %}
{% endif %}

{% assign quality_description = section.settings.description %}
{% if use_locale_copy or quality_description == blank %}
  {% assign quality_description = 'sections.quality.description' | t %}
{% endif %}

{% assign quality_link_text = section.settings.link_text %}
{% if use_locale_copy or quality_link_text == blank %}
  {% assign quality_link_text = 'sections.quality.cta' | t %}
{% endif %}

<section class="quality">
  <div class="quality-left">
    <h2>{{ quality_heading }}</h2>
    <p>{{ quality_description }}</p>
    <a class="link-arrow" href="{{ section.settings.link_url | default: pages['forschung'].url | default: '/pages/forschung' }}#sec-05">{{ quality_link_text }}</a>
    <ul class="quality-list">
      {% for block in section.blocks %}
        {% if block.type == 'feature' %}
          {% assign feature_text = block.settings.text %}
          {% if use_locale_copy %}
            {% case forloop.index %}
              {% when 1 %}
                {% assign feature_text = 'sections.quality.features.feature_1' | t %}
              {% when 2 %}
                {% assign feature_text = 'sections.quality.features.feature_2' | t %}
              {% when 3 %}
                {% assign feature_text = 'sections.quality.features.feature_3' | t %}
            {% endcase %}
          {% elsif feature_text == blank %}
            {% case forloop.index %}
              {% when 1 %}
                {% assign feature_text = 'sections.quality.features.feature_1' | t %}
              {% when 2 %}
                {% assign feature_text = 'sections.quality.features.feature_2' | t %}
              {% when 3 %}
                {% assign feature_text = 'sections.quality.features.feature_3' | t %}
            {% endcase %}
          {% endif %}
          <li {{ block.shopify_attributes }}>
            <span class="quality-check" aria-hidden="true">✓</span>
            <span class="quality-feature-text">{{ feature_text }}</span>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>

  <div class="quality-badges" role="list" aria-label="{{ 'sections.quality.aria.standards' | t }}">
    {% for block in section.blocks %}
      {% if block.type == 'badge' %}
        {% assign badge_label = block.settings.label %}
        {% if use_locale_copy or badge_label == blank %}
          {% case block.settings.icon %}
            {% when 'vegan' %}
              {% assign badge_label = 'sections.quality.badges.vegan' | t %}
            {% when 'gluten' %}
              {% assign badge_label = 'sections.quality.badges.gluten' | t %}
            {% when 'dairy' %}
              {% assign badge_label = 'sections.quality.badges.dairy' | t %}
            {% when 'soy' %}
              {% assign badge_label = 'sections.quality.badges.soy' | t %}
            {% when 'nut' %}
              {% assign badge_label = 'sections.quality.badges.nut' | t %}
            {% when 'shellfish' %}
              {% assign badge_label = 'sections.quality.badges.shellfish' | t %}
            {% when 'sesame' %}
              {% assign badge_label = 'sections.quality.badges.sesame' | t %}
            {% when 'corn' %}
              {% assign badge_label = 'sections.quality.badges.corn' | t %}
            {% when 'glyphosate' %}
              {% assign badge_label = 'sections.quality.badges.glyphosate' | t %}
            {% when 'no_fillers' %}
              {% assign badge_label = 'sections.quality.badges.no_fillers' | t %}
            {% when 'no_preservatives' %}
              {% assign badge_label = 'sections.quality.badges.no_preservatives' | t %}
            {% when 'heavy_metals' %}
              {% assign badge_label = 'sections.quality.badges.heavy_metals' | t %}
          {% endcase %}
        {% endif %}
        <div class="quality-badge" role="listitem" {{ block.shopify_attributes }}>
          {% case block.settings.icon %}
            {% when 'vegan' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M24 12v4M24 32v4M20 14l-2 3M30 27l-2 3M16 18l-3 1M35 25l-3 1" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M19 22c0-3 2.2-5 5-5s5 2 5 5c0 4-5 8-5 11-0-3-5-7-5-11Z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
              </svg>
            {% when 'gluten' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M20 14c0 0-3 6 0 10s2 10 2 10M24 14c0 0-3 6 0 10s2 10 2 10M28 14c0 0-3 6 0 10s2 10 2 10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            {% when 'dairy' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M17 18h14v3a7 7 0 0 1-14 0v-3Z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
                <path d="M24 28v5M20 33h8" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M15 14l18 18" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            {% when 'soy' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <ellipse cx="24" cy="24" rx="6" ry="8" stroke="currentColor" stroke-width="1.3"/>
                <path d="M24 16c2-3 6-4 8-2s1 6-1 9M24 32c2 3 6 4 8 2s1-6-1-9" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            {% when 'nut' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <ellipse cx="21" cy="22" rx="4" ry="5" stroke="currentColor" stroke-width="1.3"/>
                <ellipse cx="27" cy="22" rx="4" ry="5" stroke="currentColor" stroke-width="1.3"/>
                <path d="M20 27c1 3 3 5 4 7 1-2 3-4 4-7" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            {% when 'shellfish' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M18 30c2-4 4-6 6-14 2 8 4 10 6 14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 32c2.5-1.5 5-2 8-2s5.5.5 8 2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M15 14l18 18" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            {% when 'sesame' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M24 14c-5 4-7 8-7 12a7 7 0 0 0 14 0c0-4-2-8-7-12Z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
                <path d="M22 28c0-2 2-4 4-5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            {% when 'corn' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M18 34V18l4 3 4-3 4 3V34" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18 26h12M18 30h12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            {% when 'glyphosate' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M20 15h8M20 15v6l-4 8.5a2.5 2.5 0 0 0 2.2 3.5h11.6a2.5 2.5 0 0 0 2.2-3.5L28 21v-6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18 28h12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            {% when 'no_fillers' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M17 24h14M24 17v14" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M15 15l18 18" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            {% when 'no_preservatives' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M20 16v10a4 4 0 0 0 8 0V16" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M24 30v5M20 35h8" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
            {% when 'heavy_metals' %}
              <svg class="quality-badge-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                <circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="1.4"/>
                <path d="M24 16v8l-4 4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18 16h12a4 4 0 0 1 4 4v4a10 10 0 0 1-10 10h0a10 10 0 0 1-10-10v-4a4 4 0 0 1 4-4Z" stroke="currentColor" stroke-width="1.3" stroke-linejoin="round"/>
              </svg>
          {% endcase %}
          <span>{{ badge_label }}</span>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "Qualitäts-Badges",
  "tag": "section",
  "class": "section-quality",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Überschrift",
      "default": "Unabhängig getestet für alle, die alles geben"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Beschreibung",
      "default": "Unsere Qualitätsstandards beginnen bei der Rohstoffauswahl und enden nicht bei der Kapsel. Jede Charge wird zusätzlich hausintern mikrobiologisch analysiert und nach strengen Standards geprüft – damit Hr² hält, was es verspricht."
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link Text",
      "default": "Mehr zu unseren Tests →"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Hausinterne mikrobiologische Analyse jeder Charge"
        }
      ]
    },
    {
      "type": "badge",
      "name": "Badge",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            { "value": "vegan", "label": "Vegan" },
            { "value": "gluten", "label": "Gluten-geprüft" },
            { "value": "dairy", "label": "Milchprodukte-geprüft" },
            { "value": "soy", "label": "Soja-geprüft" },
            { "value": "nut", "label": "Nuss-geprüft" },
            { "value": "shellfish", "label": "Schalentier-geprüft" },
            { "value": "sesame", "label": "Sesam-geprüft" },
            { "value": "corn", "label": "Mais-geprüft" },
            { "value": "glyphosate", "label": "Glyphosat-geprüft" },
            { "value": "no_fillers", "label": "Ohne Bindemittel" },
            { "value": "no_preservatives", "label": "Ohne Konservierungsstoffe" },
            { "value": "heavy_metals", "label": "Schwermetall-geprüft" }
          ],
          "default": "vegan"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Vegan"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Qualitäts-Badges",
      "blocks": [
        { "type": "feature", "settings": { "text": "Hausinterne mikrobiologische Analyse jeder Charge" } },
        { "type": "feature", "settings": { "text": "HACCP- & ISO-Standards in der Herstellung" } },
        { "type": "feature", "settings": { "text": "Rohstoffe geprüft auf Pestizidrückstände" } },
        { "type": "badge", "settings": { "icon": "vegan", "label": "Vegan" } },
        { "type": "badge", "settings": { "icon": "gluten", "label": "Gluten-geprüft" } },
        { "type": "badge", "settings": { "icon": "dairy", "label": "Milchprodukte-geprüft" } },
        { "type": "badge", "settings": { "icon": "soy", "label": "Soja-geprüft" } },
        { "type": "badge", "settings": { "icon": "nut", "label": "Nuss-geprüft" } },
        { "type": "badge", "settings": { "icon": "shellfish", "label": "Schalentier-geprüft" } },
        { "type": "badge", "settings": { "icon": "sesame", "label": "Sesam-geprüft" } },
        { "type": "badge", "settings": { "icon": "corn", "label": "Mais-geprüft" } },
        { "type": "badge", "settings": { "icon": "glyphosate", "label": "Glyphosat / AMPA-geprüft" } },
        { "type": "badge", "settings": { "icon": "no_fillers", "label": "Ohne Bindemittel" } },
        { "type": "badge", "settings": { "icon": "no_preservatives", "label": "Ohne Konservierungsstoffe" } },
        { "type": "badge", "settings": { "icon": "heavy_metals", "label": "Schwermetall-geprüft" } }
      ]
    }
  ]
}
{% endschema %}
