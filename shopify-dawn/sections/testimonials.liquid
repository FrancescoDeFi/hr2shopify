{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign use_locale_copy = false %}
{% unless locale_prefix == 'de' %}
  {% assign use_locale_copy = true %}
{% endunless %}

{% assign testimonials = section.blocks | where: 'type', 'testimonial' %}

<section class="testi" aria-label="Testimonials">
  <div class="testi-inner">

    {% for block in section.blocks %}
      {% if block.type == 'testimonial' %}
        {% assign testimonial_quote = block.settings.quote %}
        {% assign testimonial_subtitle = block.settings.subtitle %}
        {% if use_locale_copy %}
          {% case block.settings.name %}
            {% when 'Aaron' %}
              {% assign testimonial_quote = 'sections.community.testimonials.aaron.quote' | t %}
              {% assign testimonial_subtitle = 'sections.community.testimonials.aaron.subtitle' | t %}
            {% when 'Lukas' %}
              {% assign testimonial_quote = 'sections.community.testimonials.lukas.quote' | t %}
              {% assign testimonial_subtitle = 'sections.community.testimonials.lukas.subtitle' | t %}
            {% when 'Patrick' %}
              {% assign testimonial_quote = 'sections.community.testimonials.patrick.quote' | t %}
              {% assign testimonial_subtitle = 'sections.community.testimonials.patrick.subtitle' | t %}
          {% endcase %}
        {% endif %}

        {% assign img_src = '' %}
        {% case block.settings.name %}
          {% when 'Aaron' %}  {% assign img_src = 'aaron2.png' | asset_url %}
          {% when 'Lukas' %}  {% assign img_src = 'lukas2.jpeg' | asset_url %}
          {% when 'Patrick' %}{% assign img_src = 'Patrick.jpeg' | asset_url %}
        {% endcase %}
        {% if block.settings.image != blank %}
          {% assign img_src = block.settings.image | image_url: width: 600 %}
        {% endif %}

        <div class="testi-slide{% if forloop.first %} active{% endif %}" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          <div class="testi-product">
            {% assign product_img = section.settings.product_image %}
            {% if product_img != blank %}
              <img src="{{ product_img | image_url: width: 600 }}" alt="Hr²" loading="lazy" decoding="async">
            {% else %}
              <img src="{{ 'buyimage.png' | asset_url }}" alt="Hr²" loading="lazy" decoding="async">
            {% endif %}
          </div>

          <div class="testi-content">
            <p class="testi-name">{{ block.settings.name }} {{ 'testimonials.says' | t | default: 'says:' }}</p>
            <blockquote class="testi-quote">"{{ testimonial_quote }}"</blockquote>
            <p class="testi-meta">{{ testimonial_subtitle }}</p>
          </div>
        </div>
      {% endif %}
    {% endfor %}

    <button class="testi-arrow testi-prev" aria-label="{{ 'general.accessibility.previous' | t }}">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M15 6l-6 6 6 6"/></svg>
    </button>
    <button class="testi-arrow testi-next" aria-label="{{ 'general.accessibility.next' | t }}">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M9 6l6 6-6 6"/></svg>
    </button>

  </div>
</section>

<script>
(function() {
  var section = document.querySelector('.testi');
  if (!section) return;
  var slides = Array.from(section.querySelectorAll('.testi-slide'));
  var prev = section.querySelector('.testi-prev');
  var next = section.querySelector('.testi-next');
  var current = 0;

  function show(i) {
    slides[current].classList.remove('active');
    current = (i + slides.length) % slides.length;
    slides[current].classList.add('active');
  }

  if (prev) prev.addEventListener('click', function() { show(current - 1); });
  if (next) next.addEventListener('click', function() { show(current + 1); });
})();
</script>

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "section-testimonials",
  "settings": [
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Produktbild (links)"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Foto (optional)"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "Aaron"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Untertitel",
          "default": "Hr² MITGLIED SEIT 2025"
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Zitat",
          "default": "Ich wollte keine schnellen Versprechen, die wissenschaftlich nichts bringen. Hr² ist für mich eine langfristige Lösung mit gezielten, haarwuchsfördernden Inhaltsstoffen. Nach ein paar Monaten fühlen sich meine Haare kräftiger an und ich habe wieder Vertrauen, aktiv etwas gegen den Haarausfall zu tun."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Aaron",
            "subtitle": "Hr² MITGLIED SEIT 2025",
            "quote": "Ich wollte keine schnellen Versprechen, die wissenschaftlich nichts bringen. Hr² ist für mich eine langfristige Lösung mit gezielten, haarwuchsfördernden Inhaltsstoffen. Nach ein paar Monaten fühlen sich meine Haare kräftiger an und ich habe wieder Vertrauen, aktiv etwas gegen den Haarausfall zu tun."
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Lukas",
            "subtitle": "Hr² MITGLIED SEIT 2025",
            "quote": "In stressigen Phasen habe ich immer zuerst an meinen Haaren gemerkt, dass etwas nicht passt. Hr² ist für mich wie ein kleines tägliches Reset. Ich fühle mich versorgt und muss mir darüber keine Gedanken mehr machen."
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Patrick",
            "subtitle": "Hr² MITGLIED SEIT 2025",
            "quote": "Ich arbeite und trainiere viel und hart. Irgendwann habe ich gemerkt, dass ich einen wichtigen Aspekt komplett vernachlässigt habe: meine Haare. Seit ich Hr² nehme, habe ich dieses unangenehme Gefühl endlich überwunden."
          }
        }
      ]
    }
  ]
}
{% endschema %}
