{{ 'results.css' | asset_url | stylesheet_tag }}

{% assign doc_name = section.settings.doctor_name | default: "Dr. Patrick" %}
{% assign doc_img = 'doctor.jpg' | asset_url %}
{% assign bottle_img = 'bottlenew2.png' | asset_url %}
{% assign capsule_img = 'capsule3.png' | asset_url %}
{% assign product_url = section.settings.product_url | default: "/products/hr2" %}
{% if product_url == blank %}
  {% assign product_url = routes.root_url | append: '/products/' | append: settings.primary_product_handle | replace: '//products/', '/products/' %}
{% endif %}
{% assign is_de = false %}
{% if request.locale.iso_code == 'de' %}{% assign is_de = true %}{% endif %}

<div class="results-wrapper" id="resultsWrapper">

  <!-- ════════ CODE ENTRY SCREEN ════════ -->
  <div class="results-screen results-code-entry active" id="codeEntry">
    <div class="results-entry-inner">
      <img class="doctor-photo" src="{{ doc_img }}" alt="{{ doc_name }}">
      <h1>
        {% if is_de %}Dein persönlicher<br>Haar-Gesundheitsbericht{% else %}Your Personal<br>Hair Health Report{% endif %}
      </h1>
      <p class="results-subtitle">
        {% if is_de %}Gib den Code ein, den Du von {{ doc_name }} erhalten hast.{% else %}Enter the code you received from {{ doc_name }}.{% endif %}
      </p>
      <div class="code-input-group">
        <input class="code-input" type="text" id="accessCodeInput" placeholder="{% if is_de %}Dein Code{% else %}Your code{% endif %}" maxlength="20" autocomplete="off" spellcheck="false">
        <p class="code-error" id="codeError" style="display:none;"></p>
      </div>
      <button class="results-btn" id="codeSubmitBtn">
        {% if is_de %}Ergebnisse anzeigen{% else %}View My Results{% endif %}
        <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
      </button>
    </div>
  </div>

  <!-- ════════ LOADING SCREEN ════════ -->
  <div class="results-screen results-loading" id="loadingScreen">
    <div class="loading-spinner"></div>
    <p>{% if is_de %}Dein Bericht wird vorbereitet...{% else %}Preparing your report...{% endif %}</p>
  </div>

  <!-- ════════ RESULTS DASHBOARD ════════ -->
  <div class="results-screen results-dashboard" id="resultsDashboard">

    <!-- Header -->
    <div class="results-header">
      <img class="doctor-photo-sm" src="{{ doc_img }}" alt="{{ doc_name }}">
      <p class="results-header-kicker">{% if is_de %}Erstellt von {{ doc_name }}{% else %}Prepared by {{ doc_name }}{% endif %}</p>
      <h1>{% if is_de %}Dein Haar-Gesundheitsbericht{% else %}Your Hair Health Report{% endif %}</h1>
    </div>

    <!-- Timeline wrapper -->
    <div class="results-timeline">
      <div class="results-timeline-line"></div>

      <!-- Summary -->
      <div class="results-timeline-section">
        <div class="results-timeline-dot"></div>
        <div class="results-timeline-content">
          <h3 class="results-section-heading">{% if is_de %}Verdachtsdiagnose{% else %}Suspected Diagnosis{% endif %}</h3>
          <div class="results-card results-card--summary" id="summaryCard">
            <div id="summaryContent"></div>
          </div>
        </div>
      </div>

      <!-- Causes -->
      <div class="results-timeline-section">
        <div class="results-timeline-dot"></div>
        <div class="results-timeline-content">
          <h3 class="results-section-heading">{% if is_de %}Was könnten die Ursachen sein?{% else %}What could be causing this?{% endif %}</h3>

          <div class="results-card" id="nutrientCard">
            <h2>{% if is_de %}Mikronährstoff-Analyse*{% else %}Micronutrient Analysis*{% endif %}</h2>
            <div id="nutrientBars"></div>
            <p class="results-card-footnote">{% if is_de %}*basierend auf deinen Antworten{% else %}*based on your answers{% endif %}</p>
          </div>

          <!-- Individual insight cards rendered by JS -->
          <div id="insightsContent"></div>

          <div class="results-card" id="hormonalCard" style="display:none;">
            <h2>{% if is_de %}Hormonelle Faktoren{% else %}Hormonal Factors{% endif %}</h2>
            <div id="hormonalContent"></div>
          </div>
        </div>
      </div>

      <!-- Action -->
      <div class="results-timeline-section">
        <div class="results-timeline-dot"></div>
        <div class="results-timeline-content">
          <h3 class="results-section-heading">{% if is_de %}Was kannst du dagegen machen?{% else %}What can you do about it?{% endif %}</h3>

          <div class="results-card results-card--routine" id="routineCard">
            <div id="routineContent"></div>
          </div>
        </div>
      </div>

      <!-- Recommendation -->
      <div class="results-timeline-section">
        <div class="results-timeline-dot"></div>
        <div class="results-timeline-content">
          <h3 class="results-section-heading">{% if is_de %}Was empfehlen wir dir?{% else %}What do we recommend?{% endif %}</h3>

          <div class="results-card results-card--product" id="productCard">
            <div class="product-layout">
              <div class="product-image">
                <img src="{{ bottle_img }}" alt="Hr²">
              </div>
              <div class="product-text">
                <h2 class="product-title">Hr² HAIRGROWTH+</h2>
                <p class="product-reason" id="productReason"></p>
                <ul class="product-ingredients" id="productIngredients"></ul>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /results-timeline -->

  </div>

  <!-- ════════ STICKY CHECKOUT BAR ════════ -->
  <div class="results-sticky-bar" id="resultsStickyBar" style="display:none;">
    <div class="results-sticky-inner">
      <div class="results-sticky-price">
        <span class="results-sticky-daily">1.23€/{% if is_de %}Tag{% else %}Day{% endif %}</span>
        <span class="results-sticky-total">36,75€ | {% if is_de %}Gesamt{% else %}Total{% endif %}</span>
      </div>
      <a href="{{ product_url }}" class="results-sticky-cta" id="resultsStickyBtn">
        <span>{% if is_de %}WEITER{% else %}CONTINUE{% endif %}</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
      </a>
    </div>
  </div>
</div>

<script>
  window.__RESULTS_LANG = '{{ request.locale.iso_code }}';
  window.__RESULTS_DOC_NAME = '{{ doc_name }}';
</script>
<script src="{{ 'results.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Hair Results Dashboard",
  "settings": [
    {
      "type": "text",
      "id": "doctor_name",
      "label": "Doctor Name",
      "default": "Dr. Patrick"
    },
    {
      "type": "url",
      "id": "product_url",
      "label": "Product URL"
    }
  ]
}
{% endschema %}
