{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign partners_heading = section.settings.heading %}
{% unless locale_prefix == 'de' %}
  {% assign partners_heading = 'sections.partners.kicker' | t %}
{% else %}
  {% if partners_heading == blank %}
    {% assign partners_heading = 'sections.partners.kicker' | t %}
  {% endif %}
{% endunless %}

<section class="partners" aria-labelledby="partners-title">
  <div class="partners-inner">
    <p class="partners-kicker" id="partners-title">{{ partners_heading }}</p>
    <div class="partners-logos" role="list" aria-label="{{ 'sections.partners.aria.logos' | t }}">
      {% for block in section.blocks %}
        {% if block.type == 'partner' %}
          <div class="partner-logo" role="listitem" aria-label="{{ block.settings.name }}" {{ block.shopify_attributes }}>
            {% if block.settings.logo != blank %}
              <img class="partner-img {% if block.settings.is_png %}is-png{% endif %} {% if block.settings.on_dark %}on-dark{% endif %}"
                   src="{{ block.settings.logo | image_url: width: 200 }}"
                   alt="{{ 'sections.partners.aria.logo_alt' | t: name: block.settings.name }}"
                   loading="lazy"
                   decoding="async">
            {% elsif block.settings.asset_filename != blank %}
              <img class="partner-img {% if block.settings.is_png %}is-png{% endif %} {% if block.settings.on_dark %}on-dark{% endif %}"
                   src="{{ block.settings.asset_filename | asset_url }}"
                   alt="{{ 'sections.partners.aria.logo_alt' | t: name: block.settings.name }}"
                   loading="lazy"
                   decoding="async">
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Partner Logos",
  "tag": "section",
  "class": "section-partners",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Überschrift",
      "default": "Formuliert von Wissenschaftler:innen dieser Institutionen"
    }
  ],
  "blocks": [
    {
      "type": "partner",
      "name": "Partner",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Partner Name",
          "default": "Stanford"
        },
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Logo (Upload)"
        },
        {
          "type": "text",
          "id": "asset_filename",
          "label": "Logo Dateiname (aus Assets)",
          "info": "Fallback falls kein Upload. z.B. 'sm_howl_looks_logo_02.png'"
        },
        {
          "type": "checkbox",
          "id": "is_png",
          "label": "PNG Format (für Styling)",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "on_dark",
          "label": "Für dunklen Hintergrund",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Partner Logos",
      "blocks": [
        { "type": "partner", "settings": { "name": "Stanford", "asset_filename": "sm_howl_looks_logo_02.png", "is_png": true } },
        { "type": "partner", "settings": { "name": "TUM", "asset_filename": "6144ac488b51c665750238.png", "on_dark": true } },
        { "type": "partner", "settings": { "name": "TU Wien", "asset_filename": "TU-Logo-Austria_CMYK.png", "is_png": true } },
        { "type": "partner", "settings": { "name": "LMU München", "asset_filename": "LMU_Muenchen_Logo.svg" } },
        { "type": "partner", "settings": { "name": "PMU", "asset_filename": "pmu.svg" } }
      ]
    }
  ]
}
{% endschema %}
