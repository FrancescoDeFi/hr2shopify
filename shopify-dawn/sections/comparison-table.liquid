{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign use_locale_copy = false %}
{% unless locale_prefix == 'de' %}
  {% assign use_locale_copy = true %}
{% endunless %}

{% assign comparison_cta = section.settings.cta_text %}
{% if use_locale_copy or comparison_cta == blank %}
  {% assign comparison_cta = 'sections.comparison.buy_cta' | t %}
{% endif %}

{% assign comparison_price_note = section.settings.price_note %}
{% if use_locale_copy or comparison_price_note == blank %}
  {% assign comparison_price_note = 'sections.comparison.price_note' | t %}
{% endif %}

{% assign comparison_title = section.settings.table_title %}
{% if use_locale_copy or comparison_title == blank %}
  {% assign comparison_title = 'sections.comparison.title' | t %}
{% endif %}

<section class="hair-growth-comparison" aria-label="{{ 'sections.comparison.aria.section' | t }}">
  <div class="comparison-showdown">
    <article class="comparison-panel comparison-panel-hr2" aria-label="{{ 'sections.comparison.aria.presentation' | t }}">
      {% if section.settings.product_image != blank %}
        <img class="comparison-bottle" src="{{ section.settings.product_image | image_url: width: 400 }}" alt="{{ section.settings.product_image.alt | default: 'HR2 Flasche' }}" loading="lazy" decoding="async">
      {% else %}
        <img class="comparison-bottle" src="{{ 'bottlenew2.png' | asset_url }}" alt="HR2 Flasche" loading="lazy" decoding="async">
      {% endif %}
      <a class="comparison-pill-btn" href="{{ routes.root_url | append: '/products/' | append: settings.primary_product_handle | replace: '//products/', '/products/' }}">{{ comparison_cta }}</a>
      <p class="comparison-note">{{ comparison_price_note }}</p>
    </article>

    <article class="comparison-panel comparison-panel-others" aria-label="{{ 'sections.comparison.aria.table' | t }}">
      <h3 class="comparison-table-title">{{ comparison_title }}</h3>
      <ul class="comparison-table-list" role="list">
        <li class="comparison-table-row comparison-table-head">
          <span class="comparison-table-feature">{{ 'sections.comparison.feature' | t }}</span>
          <span class="comparison-table-col">{{ 'sections.comparison.hr2' | t }}</span>
          <span class="comparison-table-col">{{ 'sections.comparison.others' | t }}</span>
        </li>
        {% for block in section.blocks %}
          {% if block.type == 'feature' %}
            {% assign feature_name = block.settings.feature_name %}
            {% if use_locale_copy %}
              {% case feature_name %}
                {% when 'Klinisch belegte Inhaltsstoffe' %}
                  {% assign feature_name = 'sections.comparison.features.clinically_proven' | t %}
                {% when 'Bio-optimiert' %}
                  {% assign feature_name = 'sections.comparison.features.bio_optimized' | t %}
                {% when 'Ohne Arzneistoffe' %}
                  {% assign feature_name = 'sections.comparison.features.without_drugs' | t %}
                {% when 'Libido-freundlich' %}
                  {% assign feature_name = 'sections.comparison.features.libido_friendly' | t %}
              {% endcase %}
            {% endif %}
            <li class="comparison-table-row" {{ block.shopify_attributes }}>
              <span class="comparison-table-feature">{{ feature_name }}</span>
              <span class="comparison-table-value">{{ block.settings.hr2_value }}</span>
              <span class="comparison-table-value {% if block.settings.others_value == 'X' %}comparison-table-value-x{% endif %}">{{ block.settings.others_value }}</span>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </article>
  </div>
</section>

{% schema %}
{
  "name": "Vergleichstabelle",
  "tag": "section",
  "class": "section-comparison",
  "settings": [
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Produktbild"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Hr² kaufen"
    },
    {
      "type": "text",
      "id": "price_note",
      "label": "Preisnotiz",
      "default": "ab 36,75 € pro Monat"
    },
    {
      "type": "text",
      "id": "table_title",
      "label": "Tabellen-Titel",
      "default": "Vergleich"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Merkmal",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Merkmal Name",
          "default": "Klinisch belegte Inhaltsstoffe"
        },
        {
          "type": "text",
          "id": "hr2_value",
          "label": "Hr² Wert",
          "default": "✓"
        },
        {
          "type": "text",
          "id": "others_value",
          "label": "Andere Wert",
          "default": "~"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vergleichstabelle",
      "blocks": [
        {
          "type": "feature",
          "settings": {
            "feature_name": "Klinisch belegte Inhaltsstoffe",
            "hr2_value": "✓",
            "others_value": "~"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Bio-optimiert",
            "hr2_value": "✓",
            "others_value": "X"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Ohne Arzneistoffe",
            "hr2_value": "✓",
            "others_value": "~"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Libido-freundlich",
            "hr2_value": "✓",
            "others_value": "~"
          }
        }
      ]
    }
  ]
}
{% endschema %}
