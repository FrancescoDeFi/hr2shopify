{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign use_locale_copy = false %}
{% unless locale_prefix == 'de' %}
  {% assign use_locale_copy = true %}
{% endunless %}

{% assign comparison_cta = section.settings.cta_text %}
{% if use_locale_copy or comparison_cta == blank %}
  {% assign comparison_cta = 'sections.comparison.buy_cta' | t %}
{% endif %}

{% assign comparison_price_note = section.settings.price_note %}
{% if use_locale_copy or comparison_price_note == blank %}
  {% assign comparison_price_note = 'sections.comparison.price_note' | t %}
{% endif %}

{% assign comparison_title = section.settings.table_title %}
{% if use_locale_copy or comparison_title == blank %}
  {% assign comparison_title = 'sections.comparison.title' | t %}
{% endif %}

<section class="hair-growth-comparison" aria-label="{{ 'sections.comparison.aria.section' | t }}">
  <div class="comparison-showdown">
    <article class="comparison-panel comparison-panel-hr2" aria-label="{{ 'sections.comparison.aria.presentation' | t }}">
      {% if section.settings.product_image != blank %}
        <img class="comparison-bottle" src="{{ section.settings.product_image | image_url: width: 400 }}" alt="{{ section.settings.product_image.alt | default: 'HR2 Flasche' }}" loading="lazy" decoding="async">
      {% else %}
        <img class="comparison-bottle" src="{{ 'bottlenew2.png' | asset_url }}" alt="HR2 Flasche" loading="lazy" decoding="async">
      {% endif %}
      <a class="comparison-pill-btn" href="{{ routes.root_url | append: '/products/' | append: settings.primary_product_handle | replace: '//products/', '/products/' }}">{{ comparison_cta }}</a>
      <p class="comparison-note">{{ comparison_price_note }}</p>
    </article>

    <article class="comparison-panel comparison-panel-others" aria-label="{{ 'sections.comparison.aria.table' | t }}">
      <div class="ct-grid">
        <div class="ct-col ct-col-features">
          <div class="ct-header ct-header-empty"></div>
          {% for block in section.blocks %}
            {% if block.type == 'feature' %}
              {% assign feature_name = block.settings.feature_name %}
              {% if use_locale_copy %}
                {% case feature_name %}
                  {% when 'Klinisch geprüfte Inhaltsstoffe' %}
                    {% assign feature_name = 'sections.comparison.features.clinically_proven' | t %}
                  {% when 'Bio-optimiert' %}
                    {% assign feature_name = 'sections.comparison.features.bio_optimized' | t %}
                  {% when 'Ohne Arzneistoffe' %}
                    {% assign feature_name = 'sections.comparison.features.without_drugs' | t %}
                  {% when 'Libido-freundlich' %}
                    {% assign feature_name = 'sections.comparison.features.libido_friendly' | t %}
                {% endcase %}
              {% endif %}
              <div class="ct-cell ct-feature" {{ block.shopify_attributes }}>{{ feature_name }}</div>
            {% endif %}
          {% endfor %}
        </div>

        <div class="ct-col ct-col-hr2">
          <div class="ct-header">
            <img class="ct-header-img" src="{{ 'capsule3.png' | asset_url }}" alt="Hr² Kapsel" loading="lazy" decoding="async">
            <span class="ct-header-label">Hr²</span>
          </div>
          {% for block in section.blocks %}
            {% if block.type == 'feature' %}
              <div class="ct-cell ct-icon" {{ block.shopify_attributes }}>
                {% if block.settings.hr2_value == '✓' %}
                  <svg class="ct-check" width="28" height="28" viewBox="0 0 28 28" fill="none" aria-label="{{ 'sections.comparison.aria.yes' | t | default: 'Ja' }}">
                    <circle cx="14" cy="14" r="13" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M9 14.5l3.5 3.5 6.5-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                {% else %}
                  <span class="ct-value-text">{{ block.settings.hr2_value }}</span>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>

        <div class="ct-col ct-col-others">
          <div class="ct-header">
            <svg class="ct-header-pill" width="60" height="36" viewBox="0 0 60 36" aria-hidden="true">
              <ellipse cx="22" cy="18" rx="16" ry="14" fill="#d0d0d0"/>
              <ellipse cx="38" cy="18" rx="16" ry="14" fill="#b0c8e0"/>
            </svg>
            <span class="ct-header-label">{{ 'sections.comparison.others' | t }}</span>
          </div>
          {% for block in section.blocks %}
            {% if block.type == 'feature' %}
              <div class="ct-cell ct-icon" {{ block.shopify_attributes }}>
                {% if block.settings.others_value == 'X' %}
                  <svg class="ct-x" width="28" height="28" viewBox="0 0 28 28" fill="none" aria-label="{{ 'sections.comparison.aria.no' | t | default: 'Nein' }}">
                    <circle cx="14" cy="14" r="13" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M10 10l8 8M18 10l-8 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  </svg>
                {% else %}
                  <svg class="ct-x" width="28" height="28" viewBox="0 0 28 28" fill="none" aria-label="{{ 'sections.comparison.aria.no' | t | default: 'Nein' }}">
                    <circle cx="14" cy="14" r="13" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M10 10l8 8M18 10l-8 8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                  </svg>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </article>
  </div>
</section>

{% schema %}
{
  "name": "Vergleichstabelle",
  "tag": "section",
  "class": "section-comparison",
  "settings": [
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Produktbild"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "Hr² kaufen"
    },
    {
      "type": "text",
      "id": "price_note",
      "label": "Preisnotiz",
      "default": "ab 36,75 € pro Monat"
    },
    {
      "type": "text",
      "id": "table_title",
      "label": "Tabellen-Titel",
      "default": "Vergleich"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Merkmal",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Merkmal Name",
          "default": "Klinisch geprüfte Inhaltsstoffe"
        },
        {
          "type": "text",
          "id": "hr2_value",
          "label": "Hr² Wert",
          "default": "✓"
        },
        {
          "type": "text",
          "id": "others_value",
          "label": "Andere Wert",
          "default": "~"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Vergleichstabelle",
      "blocks": [
        {
          "type": "feature",
          "settings": {
            "feature_name": "Klinisch geprüfte Inhaltsstoffe",
            "hr2_value": "✓",
            "others_value": "~"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Bio-optimiert",
            "hr2_value": "✓",
            "others_value": "X"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Ohne Arzneistoffe",
            "hr2_value": "✓",
            "others_value": "~"
          }
        },
        {
          "type": "feature",
          "settings": {
            "feature_name": "Libido-freundlich",
            "hr2_value": "✓",
            "others_value": "~"
          }
        }
      ]
    }
  ]
}
{% endschema %}
