{% assign locale_prefix = request.locale.iso_code | downcase | slice: 0, 2 %}
{% assign use_locale_copy = false %}
{% unless locale_prefix == 'de' %}
  {% assign use_locale_copy = true %}
{% endunless %}

{% assign offer_title = section.settings.product_title %}
{% if use_locale_copy or offer_title == blank %}
  {% assign offer_title = 'sections.offer.title' | t %}
{% endif %}

{% assign offer_description = section.settings.product_description %}
{% if use_locale_copy or offer_description == blank %}
  {% assign offer_description = 'sections.offer.description' | t %}
{% endif %}

{% assign offer_cta = section.settings.cta_text %}
{% if use_locale_copy or offer_cta == blank %}
  {% assign offer_cta = 'sections.offer.cta' | t %}
{% endif %}

{% assign offer_one_time = section.settings.one_time_text %}
{% if use_locale_copy or offer_one_time == blank %}
  {% assign offer_one_time = 'sections.offer.once_link' | t: price: settings.onetime_price, shipping: settings.onetime_shipping %}
{% endif %}

{% assign offer_guarantee = section.settings.guarantee_text %}
{% if use_locale_copy or offer_guarantee == blank %}
  {% assign offer_guarantee = 'sections.offer.guarantee' | t %}
{% endif %}

{% assign offer_tagline = section.settings.promo_tagline %}
{% if use_locale_copy or offer_tagline == blank %}
  {% assign offer_tagline = 'sections.offer.tagline' | t %}
{% endif %}

{% assign offer_promo_heading = section.settings.promo_heading %}
{% if use_locale_copy or offer_promo_heading == blank %}
  {% assign offer_promo_heading = 'sections.offer.promo_heading' | t %}
{% endif %}

<section class="offer">
  <div class="offer-left">
    <h2 class="offer-product-title">{{ offer_title }}</h2>

    <p class="offer-product-description">
      {{ offer_description }}
    </p>

    <div class="offer-plans" role="radiogroup" aria-label="{{ 'sections.offer.aria.delivery_options' | t }}">
      {% for block in section.blocks %}
        {% if block.type == 'plan' %}
          {% assign plan_name = block.settings.name %}
          {% assign plan_badge = block.settings.badge %}
          {% assign plan_description = block.settings.description %}
          {% if use_locale_copy %}
            {% case block.settings.value %}
              {% when 'monthly' %}
                {% assign plan_name = 'sections.offer.plans.monthly.name' | t %}
                {% assign plan_badge = 'sections.offer.plans.monthly.badge' | t %}
                {% assign plan_description = 'sections.offer.plans.monthly.description' | t %}
              {% when '3month' %}
                {% assign plan_name = 'sections.offer.plans.three_month.name' | t %}
                {% assign plan_badge = 'sections.offer.plans.three_month.badge' | t %}
                {% assign plan_description = 'sections.offer.plans.three_month.description' | t %}
              {% when '6month' %}
                {% assign plan_name = 'sections.offer.plans.six_month.name' | t %}
                {% assign plan_badge = 'sections.offer.plans.six_month.badge' | t %}
                {% assign plan_description = 'sections.offer.plans.six_month.description' | t %}
            {% endcase %}
          {% else %}
            {% if plan_name == blank or plan_badge == blank or plan_description == blank %}
              {% case block.settings.value %}
                {% when 'monthly' %}
                  {% if plan_name == blank %}{% assign plan_name = 'sections.offer.plans.monthly.name' | t %}{% endif %}
                  {% if plan_badge == blank %}{% assign plan_badge = 'sections.offer.plans.monthly.badge' | t %}{% endif %}
                  {% if plan_description == blank %}{% assign plan_description = 'sections.offer.plans.monthly.description' | t %}{% endif %}
                {% when '3month' %}
                  {% if plan_name == blank %}{% assign plan_name = 'sections.offer.plans.three_month.name' | t %}{% endif %}
                  {% if plan_badge == blank %}{% assign plan_badge = 'sections.offer.plans.three_month.badge' | t %}{% endif %}
                  {% if plan_description == blank %}{% assign plan_description = 'sections.offer.plans.three_month.description' | t %}{% endif %}
                {% when '6month' %}
                  {% if plan_name == blank %}{% assign plan_name = 'sections.offer.plans.six_month.name' | t %}{% endif %}
                  {% if plan_badge == blank %}{% assign plan_badge = 'sections.offer.plans.six_month.badge' | t %}{% endif %}
                  {% if plan_description == blank %}{% assign plan_description = 'sections.offer.plans.six_month.description' | t %}{% endif %}
              {% endcase %}
            {% endif %}
          {% endif %}
          <label class="offer-plan{% if forloop.first %} is-selected{% endif %}" {{ block.shopify_attributes }}>
            <input class="offer-plan-radio" type="radio" name="offer-plan" value="{{ block.settings.value }}" {% if forloop.first %}checked{% endif %}>
            <div class="offer-plan-title">
              <span class="offer-plan-name">{{ plan_name }}</span>
              {% if plan_badge != blank %}
                <span class="offer-plan-badge">{{ plan_badge }}</span>
              {% endif %}
            </div>
            <div class="offer-plan-price">
              <div class="offer-plan-price-new">{{ block.settings.price_new }}</div>
              {% if block.settings.price_old != blank %}
                <div class="offer-plan-price-old">{{ block.settings.price_old }}</div>
              {% endif %}
            </div>
          </label>
        {% endif %}
      {% endfor %}
    </div>

    <a class="offer-start-btn" href="{{ routes.root_url | append: '/products/' | append: settings.primary_product_handle | replace: '//products/', '/products/' }}">{{ offer_cta }} <span aria-hidden="true">→</span></a>

    {% if section.settings.show_one_time %}
      <div class="offer-once">
        <a class="offer-once-link" href="{{ routes.root_url | append: '/products/' | append: settings.primary_product_handle | replace: '//products/', '/products/' }}">{{ offer_one_time }}</a>
      </div>
    {% endif %}

    <p class="offer-guarantee-note">{{ offer_guarantee }}</p>
  </div>

  <div class="offer-right">
    <div class="offer-tagline">{{ offer_tagline }}</div>
    <h3>{{ offer_promo_heading }}</h3>
    {% if section.settings.promo_image != blank %}
      <img src="{{ section.settings.promo_image | image_url: width: 600 }}" alt="{{ section.settings.promo_image.alt | default: 'Hr² Bundle' }}" loading="lazy" decoding="async">
    {% else %}
      <img src="{{ 'bottlew.png' | asset_url }}" alt="Hr² Bundle" loading="lazy" decoding="async">
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Angebot & Preise",
  "tag": "section",
  "class": "section-offer",
  "settings": [
    {
      "type": "text",
      "id": "product_title",
      "label": "Produkt-Titel",
      "default": "Hr²"
    },
    {
      "type": "textarea",
      "id": "product_description",
      "label": "Produkt-Beschreibung",
      "default": "Hr² ist dein tägliches Supplement für die Haargesundheit – entwickelt mit einem Fokus auf ausgewählte Inhaltsstoffe, Qualitätssicherung und eine einfache Routine."
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Button Text",
      "default": "In den Warenkorb"
    },
    {
      "type": "checkbox",
      "id": "show_one_time",
      "label": "Einmalkauf anzeigen",
      "default": true
    },
    {
      "type": "text",
      "id": "one_time_text",
      "label": "Einmalkauf Text",
      "default": "Einmal kaufen für €49,00 + 4,95€ Versand"
    },
    {
      "type": "text",
      "id": "guarantee_text",
      "label": "Garantie Text",
      "default": "Kostenloser Versand. Jederzeit pausieren oder kündigen."
    },
    {
      "type": "header",
      "content": "Promo Bereich"
    },
    {
      "type": "text",
      "id": "promo_tagline",
      "label": "Promo Tagline",
      "default": "Das erste Mal. Nur für kurze Zeit."
    },
    {
      "type": "text",
      "id": "promo_heading",
      "label": "Promo Überschrift",
      "default": "Dein Hr² jetzt für €41,65"
    },
    {
      "type": "image_picker",
      "id": "promo_image",
      "label": "Promo Bild"
    }
  ],
  "blocks": [
    {
      "type": "plan",
      "name": "Abo-Plan",
      "settings": [
        {
          "type": "text",
          "id": "value",
          "label": "Wert (für Formular)",
          "default": "monthly"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Plan Name",
          "default": "Monatliche Lieferung"
        },
        {
          "type": "text",
          "id": "badge",
          "label": "Badge Text",
          "default": "Spare 15%"
        },
        {
          "type": "text",
          "id": "price_new",
          "label": "Neuer Preis",
          "default": "€41,65"
        },
        {
          "type": "text",
          "id": "price_old",
          "label": "Alter Preis (durchgestrichen)",
          "default": "€49,00"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Beschreibung",
          "default": "1-Monats-Vorrat"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Angebot & Preise",
      "blocks": [
        {
          "type": "plan",
          "settings": {
            "value": "monthly",
            "name": "Monatliche Lieferung",
            "badge": "Spare 15%",
            "price_new": "€41,65",
            "price_old": "€49,00",
            "description": "1-Monats-Vorrat"
          }
        },
        {
          "type": "plan",
          "settings": {
            "value": "3month",
            "name": "3-Monats-Lieferung",
            "badge": "Spare 20%",
            "price_new": "€39,20",
            "price_old": "€49,00",
            "description": "3-Monats-Vorrat"
          }
        },
        {
          "type": "plan",
          "settings": {
            "value": "6month",
            "name": "6-Monats-Lieferung",
            "badge": "Spare 25%",
            "price_new": "€36,75",
            "price_old": "€49,00",
            "description": "6-Monats-Vorrat"
          }
        }
      ]
    }
  ]
}
{% endschema %}
