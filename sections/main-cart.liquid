<div class="cart-page">
  <div class="cart-inner">
    {% if cart.item_count == 0 %}
      <div class="cart-empty">
        <h1>{{ section.settings.empty_title | default: 'Dein Warenkorb ist leer' }}</h1>
        <p>{{ section.settings.empty_message | default: 'Entdecke unsere Produkte und starte deine Haar-Gesundheitsreise.' }}</p>
        <a href="{{ routes.root_url }}products/{{ settings.primary_product_handle }}" class="primary-btn">
          {{ section.settings.empty_cta | default: 'Jetzt einkaufen' }}
        </a>
      </div>
    {% else %}
      <h1 class="cart-title">{{ section.settings.title | default: 'Warenkorb' }}</h1>

      <form action="{{ routes.cart_url }}" method="post" id="cart-form">
        <div class="cart-items">
          {% for item in cart.items %}
            <div class="cart-item" data-line="{{ forloop.index }}">
              <div class="cart-item-image">
                {% if item.image %}
                  <img src="{{ item.image | image_url: width: 200 }}" alt="{{ item.title | escape }}" loading="lazy">
                {% else %}
                  <div class="cart-item-placeholder"></div>
                {% endif %}
              </div>

              <div class="cart-item-details">
                <h3 class="cart-item-title">
                  <a href="{{ item.url }}">{{ item.product.title }}</a>
                </h3>

                {% if item.variant.title != 'Default Title' %}
                  <p class="cart-item-variant">{{ item.variant.title }}</p>
                {% endif %}

                {% if item.selling_plan_allocation %}
                  <p class="cart-item-selling-plan">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                {% endif %}

                <div class="cart-item-price">
                  {% if item.original_line_price != item.final_line_price %}
                    <span class="cart-item-price-old">{{ item.original_line_price | money }}</span>
                  {% endif %}
                  <span class="cart-item-price-new">{{ item.final_line_price | money }}</span>
                </div>
              </div>

              <div class="cart-item-quantity">
                <label for="updates_{{ item.key }}" class="visually-hidden">Menge</label>
                <div class="quantity-selector">
                  <button type="button" class="quantity-btn quantity-minus" aria-label="Menge verringern" data-action="decrease">−</button>
                  <input type="number"
                         name="updates[]"
                         id="updates_{{ item.key }}"
                         value="{{ item.quantity }}"
                         min="0"
                         aria-label="Menge für {{ item.product.title }}"
                         class="quantity-input">
                  <button type="button" class="quantity-btn quantity-plus" aria-label="Menge erhöhen" data-action="increase">+</button>
                </div>
              </div>

              <div class="cart-item-remove">
                <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity=0" class="cart-remove-btn" aria-label="Entfernen">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                    <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/>
                  </svg>
                </a>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="cart-footer">
          <div class="cart-totals">
            {% if cart.cart_level_discount_applications.size > 0 %}
              <div class="cart-discounts">
                {% for discount in cart.cart_level_discount_applications %}
                  <div class="cart-discount">
                    <span>{{ discount.title }}</span>
                    <span>-{{ discount.total_allocated_amount | money }}</span>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            <div class="cart-subtotal">
              <span>{{ section.settings.subtotal_label | default: 'Zwischensumme' }}</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            <p class="cart-note">{{ section.settings.shipping_note | default: 'Versandkosten werden beim Checkout berechnet.' }}</p>
          </div>

          <div class="cart-actions">
            <button type="submit" name="update" class="outline-btn cart-update-btn">
              {{ section.settings.update_button | default: 'Warenkorb aktualisieren' }}
            </button>
            <button type="submit" name="checkout" class="primary-btn cart-checkout-btn">
              {{ section.settings.checkout_button | default: 'Zur Kasse' }} <span aria-hidden="true">→</span>
            </button>
          </div>
        </div>
      </form>

      {% if section.settings.show_continue_shopping %}
        <div class="cart-continue">
          <a href="{{ routes.all_products_collection_url | default: routes.root_url }}" class="link-arrow">
            ← {{ section.settings.continue_shopping_text | default: 'Weiter einkaufen' }}
          </a>
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>

<style>
  .cart-page {
    padding: 4rem 1.5rem;
    max-width: 900px;
    margin: 0 auto;
  }

  .cart-empty {
    text-align: center;
    padding: 4rem 0;
  }

  .cart-empty h1 {
    font-size: 2rem;
    margin-bottom: 1rem;
  }

  .cart-empty p {
    color: #666;
    margin-bottom: 2rem;
  }

  .cart-title {
    font-size: 2rem;
    margin-bottom: 2rem;
    text-align: center;
  }

  .cart-items {
    border-top: 1px solid #e5e5e5;
  }

  .cart-item {
    display: grid;
    grid-template-columns: 100px 1fr auto auto;
    gap: 1.5rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid #e5e5e5;
    align-items: center;
  }

  @media (max-width: 640px) {
    .cart-item {
      grid-template-columns: 80px 1fr;
      gap: 1rem;
    }

    .cart-item-quantity,
    .cart-item-remove {
      grid-column: 2;
    }
  }

  .cart-item-image img {
    width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .cart-item-placeholder {
    width: 100%;
    padding-bottom: 100%;
    background: #f5f5f5;
    border-radius: 8px;
  }

  .cart-item-title a {
    color: inherit;
    text-decoration: none;
    font-weight: 600;
  }

  .cart-item-title a:hover {
    text-decoration: underline;
  }

  .cart-item-variant,
  .cart-item-selling-plan {
    font-size: 0.875rem;
    color: #666;
    margin: 0.25rem 0;
  }

  .cart-item-selling-plan {
    color: var(--brand-green, #3c0c1c);
    font-weight: 500;
  }

  .cart-item-price-old {
    text-decoration: line-through;
    color: #999;
    margin-right: 0.5rem;
  }

  .cart-item-price-new {
    font-weight: 600;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #e5e5e5;
    border-radius: 4px;
    overflow: hidden;
  }

  .quantity-btn {
    width: 36px;
    height: 36px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quantity-btn:hover {
    background: #f5f5f5;
  }

  .quantity-input {
    width: 48px;
    height: 36px;
    border: none;
    text-align: center;
    font-size: 1rem;
    -moz-appearance: textfield;
  }

  .quantity-input::-webkit-inner-spin-button,
  .quantity-input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .cart-remove-btn {
    color: #999;
    transition: color 0.2s;
  }

  .cart-remove-btn:hover {
    color: #333;
  }

  .cart-footer {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #333;
  }

  .cart-totals {
    text-align: right;
    margin-bottom: 1.5rem;
  }

  .cart-discount {
    display: flex;
    justify-content: flex-end;
    gap: 2rem;
    color: var(--brand-green, #3c0c1c);
    margin-bottom: 0.5rem;
  }

  .cart-subtotal {
    display: flex;
    justify-content: flex-end;
    gap: 2rem;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .cart-note {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.5rem;
  }

  .cart-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
  }

  @media (max-width: 640px) {
    .cart-actions {
      flex-direction: column;
    }
  }

  .cart-update-btn {
    padding: 0.875rem 1.5rem;
  }

  .cart-checkout-btn {
    padding: 0.875rem 2rem;
  }

  .cart-continue {
    margin-top: 2rem;
    text-align: center;
  }

  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var quantityBtns = document.querySelectorAll('.quantity-btn');

    quantityBtns.forEach(function(btn) {
      btn.addEventListener('click', function() {
        var input = this.parentNode.querySelector('.quantity-input');
        var currentValue = parseInt(input.value, 10) || 0;

        if (this.dataset.action === 'increase') {
          input.value = currentValue + 1;
        } else if (this.dataset.action === 'decrease' && currentValue > 0) {
          input.value = currentValue - 1;
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Warenkorb",
  "tag": "section",
  "class": "section-cart",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Titel",
      "default": "Warenkorb"
    },
    {
      "type": "header",
      "content": "Leerer Warenkorb"
    },
    {
      "type": "text",
      "id": "empty_title",
      "label": "Leerer Warenkorb Titel",
      "default": "Dein Warenkorb ist leer"
    },
    {
      "type": "text",
      "id": "empty_message",
      "label": "Leerer Warenkorb Nachricht",
      "default": "Entdecke unsere Produkte und starte deine Haar-Gesundheitsreise."
    },
    {
      "type": "text",
      "id": "empty_cta",
      "label": "Leerer Warenkorb CTA",
      "default": "Jetzt einkaufen"
    },
    {
      "type": "header",
      "content": "Warenkorb Fußzeile"
    },
    {
      "type": "text",
      "id": "subtotal_label",
      "label": "Zwischensumme Label",
      "default": "Zwischensumme"
    },
    {
      "type": "text",
      "id": "shipping_note",
      "label": "Versand-Hinweis",
      "default": "Versandkosten werden beim Checkout berechnet."
    },
    {
      "type": "text",
      "id": "update_button",
      "label": "Aktualisieren Button",
      "default": "Warenkorb aktualisieren"
    },
    {
      "type": "text",
      "id": "checkout_button",
      "label": "Checkout Button",
      "default": "Zur Kasse"
    },
    {
      "type": "checkbox",
      "id": "show_continue_shopping",
      "label": "Weiter einkaufen Link anzeigen",
      "default": true
    },
    {
      "type": "text",
      "id": "continue_shopping_text",
      "label": "Weiter einkaufen Text",
      "default": "Weiter einkaufen"
    }
  ]
}
{% endschema %}
